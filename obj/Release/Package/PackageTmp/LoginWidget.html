<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://global.oktacdn.com/okta-signin-widget/3.1.3/js/okta-sign-in.min.js" type="text/javascript"></script>
    <link href="https://global.oktacdn.com/okta-signin-widget/3.1.3/css/okta-sign-in.min.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript">
        var oktaSignIn = new OktaSignIn({
            baseUrl: 'https://twu.oktapreview.com',
            clientId: '0oapyuy16plWi5epe0h7',
            redirectUri: 'https://localhost:44332/LoginWidget.html',
            authParams: {
                issuer: 'https://twu.oktapreview.com/oauth2/default',
                responseType: ['token', 'id_token'],
                display: 'page'
            }
        });
        if (oktaSignIn.hasTokensInUrl()) {
            oktaSignIn.authClient.token.parseFromUrl().then(function success(tokens) {
                // Save the tokens for later use, e.g. if the page gets refreshed:
                // Add the token to tokenManager to automatically renew the token when needed
                tokens.forEach(function (token) {
                    if (token.idToken) {
                        oktaSignIn.authClient.tokenManager.add('idToken', token);
                    }
                    if (token.accessToken) {
                        oktaSignIn.authClient.tokenManager.add('accessToken', token);
                    }
                });

                // Say hello to the person who just signed in:
                oktaSignIn.authClient.tokenManager.get('idToken').then(function (idToken) {
                    document.write('Hello, ' + idToken.claims.email);
                    document.write('</br>');
                    document.write('</br>');
                    document.write('<a onclick="logout()" href="javascript:void(0);">logout</a>');
                    document.write('</br>');
                    document.write('<a onclick="refresh()" href="javascript:void(0);">refresh</a>');
                });
            },
                function error(err) {
                    // handle errors as needed
                    document.write(err);
                }
            );
        } else {
            oktaSignIn.authClient.session.get().then(function (res) {
                // Session exists, show logged in state.
                if (res.status === 'ACTIVE') {
                    document.write('Welcome back, ' + res.login);
                    document.write('</br>');
                    document.write('</br>');
                    document.write('<a onclick="logout()" href="javascript:void(0);">logout</a>');
                    document.write('</br>');
                    document.write('<a onclick="refresh()" href="javascript:void(0);">refresh</a>');
                   return;
                }
                // No session, show the login form
                oktaSignIn.renderEl(
                    { el: '#okta-login-container' },
                    function success(res) {
                        // Nothing to do in this case, the widget will automatically redirect
                        // the user to Okta for authentication, then back to this page if successful
                    },
                    function error(err) {
                        // handle errors as needed
                        document.write(err);
                    }
                );
            });
        }

        function logout() {
            this.oktaSignIn.authClient.signOut()
        }

        function refresh() {
            window.location.reload();
        }

    </script>
</head>

<body>
    <div id="okta-login-container"></div>
</body>
</html>